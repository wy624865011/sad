<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
<meta name="format-detection" content="telephone=no" /> 
<title>他们过的不太好</title>
<!-- demo css -->
<link rel="stylesheet" type="text/css" href="css/demo.css" />
</head>
<body>
<audio id="audio" preload="auto" autoplay="autoplay" loop="loop" src="http://y0.ifengimg.com/29daa33abbbc4bbc/2015/3/newsbgm.mp3">
</audio>

<div class="loadPage">
    <div class="loading">
        <div class="loading-num">Loading...<span></span></div>
    </div>
</div>

<div class="global">
    <div class="screen">
        <!-- 1b -->
        <div class="layout index" id="layout_1">
            <div class="inner">
                <div class="rocle"><img class="loadPic"  src="img/bb.png" /></div>
                <ul class="picScl" id="picScl" >
                    <li><span class="p1" ><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_1.jpg"/></span></li>
                    <li><span class="p2" ><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_2.jpg"/></span></li>
                    <li><span class="p3" ><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_3.jpg"/></span></li>
                    <li><span class="p4" ><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_4.jpg"/></span></li>
                    <li><span class="p5" ><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_5.jpg"/></span></li>
                </ul>
            </div>
            <div class="swipe_tip"></div>
        </div>
        <!-- 1e -->

        <!-- 2b -->
            <div class="layout sPic screen01">
                <div class="inner">
                    <h2><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_3.png" alt="" /></h2>
                    <div class="bd">
                        <ul class="picList">
                            <li>
                                <div class="layerbox" layer="1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_4.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_1.jpg" />
                                </div>
                                
                            </li>
                            <li>
                                <div class="layerbox" layer="-1.5">
                                <div class="text">
                                    <p class=""><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_5.png" alt="" /></p>
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_2.jpg" />
                                </div>
                                
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 2e -->

        <!-- 3b -->
            <div class="layout sPic screen02">
                <div class="inner animate">
                    <div class="bd">
                        <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg3_1.jpg" />
                        <div class="s2-tit">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg3_2.png" />
                        </div>
                        <div class="s2-txt">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg3_3.png" />
                        </div>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 3e -->

        <!-- 4b -->
            <div class="layout hPic screen03">
                <div class="inner animate">
                    <div class="bd">
                        <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg4_1.jpg" />
                        <div class="s3-tit">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg4_2.png" />
                        </div>
                        <div class="s3-txt">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg4_3.png" />
                        </div>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 4e -->

        <!-- 5b -->
            <div class="layout sPic screen04">
                <div class="inner">
                    <h2><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg5_3.png" alt="" /></h2>
                    <div class="bd">
                        <ul class="picList">
                            <li>
                                <div class="layerbox" layer="1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg5_4.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg5_1.jpg"/>
                                </div>
                                
                            </li>
                            <li>
                                <div class="layerbox" layer="-1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg5_5.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg5_2.jpg"/>
                                </div>
                                
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 5e -->

        <!-- 6b -->
            <div class="layout sPic screen05">
                <div class="inner">
                    <h2><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg6_3.png" alt="" /></h2>
                    <div class="bd">
                        <ul class="picList">
                            <li>
                                <div class="layerbox" layer="1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg6_4.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg6_1.jpg"/>
                                </div>
                            </li>
                            <li>
                                <div class="layerbox" layer="-1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg6_5.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg6_2.jpg"/>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 6e -->

        <!-- 7b -->
            <div class="layout hPic screen06">
                <div class="inner animate">
                    <div class="bd">
                        <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg7_1.jpg" />
                        <div class="s6-tit">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg7_2.png" />
                        </div>
                        <div class="s6-txt">
                            <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg7_3.png" />
                        </div>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 7e -->

        <!-- 8b -->
            <div class="layout sPic screen07">
                <div class="inner">
                    <h2><img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg8_3.png" alt="" /></h2>
                    <div class="bd">
                        <ul class="picList">
                            <li>
                                <div class="layerbox" layer="1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg8_4.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg8_1.jpg"/>
                                </div>
                            </li>
                            <li>
                                <div class="layerbox" layer="-1.5">
                                <div class="text">
                                    <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg8_5.png" alt="" />
                                </div>
                                <img class="loadPic" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg8_2.jpg"/>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="swipe_tip"></div>
            </div>
        <!-- 8e -->

        <!-- 9b -->
            <div class="layout vidBox">
                <div class="inner pageOut">
                    <div class="bd">
                        <div class="video videoBoj" id="video2">
                            <img src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg9_4.png" />
                        </div>
                        <p class="tis">（点击播放视频，观看更多精彩）</p>
                        <p class="intr"><img src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg9_2.png" /></p>
                
                    </div>
                    <ul class="ftBnt">
                        <li><a href="javascript:;" class="share_btn">分享至朋友圈</a></li>
                        <li><a href="javascript:;" title="" target="_blank" class="backBnt">返回首页</a></li>
                    </ul>
                    <div class="mainvideo" id="mainvideo01"> 
                       
                    </div>
                </div>
            </div>
        <!-- 9e -->
    </div>
</div>
<div class="songBox" style="z-index:10001">
    <span class="open"></span>
    <span class="close"></span>
</div>
<div class="coverShare" id="coverShare"></div>
<div class="mask flexcontainer" id="mask">
    <div class="mask-box">
        <div class="mask-pic"><i></i></div>
        <span>为了更好的体验，请将手机/平板竖过来</span>
    </div>
</div>
<script type="text/javascript" src="http://y3.ifengimg.com/l/2014/52/73533e3083aaa7e/zepto.min.js"></script>
<script type="text/javascript" src="http://y1.ifengimg.com/5887c5da2472fe29/2015/3/touch1.js"></script>
<script type="text/javascript">
// Layout part.
var Layout = {
    UA: function() {
        var userAgent = navigator.userAgent.toLowerCase();
        return {
            ipad: /ipad/.test(userAgent),
            iphone: /iphone/.test(userAgent),
            android: /android/.test(userAgent),
            weixin: /micromessenger/.test(userAgent),
            qqnews_version: userAgent.match(/qqnews/i) == "qqnews" ? userAgent.split('qqnews/')[1] : ''
        };
    },

    compareVersions: function(v1, comparator, v2) {
        comparator = comparator == '=' ? '==' : comparator;
        var v1parts = v1.split('.'), v2parts = v2.split('.');
        var maxLen = Math.max(v1parts.length, v2parts.length);
        var part1, part2;
        var cmp = 0;
        for(var i = 0; i < maxLen && !cmp; i++) {
            part1 = parseInt(v1parts[i], 10) || 0;
            part2 = parseInt(v2parts[i], 10) || 0;
            if(part1 < part2)
                cmp = 1;
            if(part1 > part2)
                cmp = -1;
        }
        return eval('0' + comparator + cmp);
    },

    page: function (i, _h){
        $(".layout .inner").removeClass("animate");
        $(".layout").eq(i).find(".inner").addClass("animate");
        setTimeout(function(){$(".layout").eq(i).show().siblings().hide();$(".layout").eq(i).addClass("on").siblings().removeClass("on");},500)
    },

    swipe: function(_h, _len) {
        var _this = this;
        $(".layout").each(function(index, obj){
            $(obj).on("swipeUp", function(){
                 $("#mainvideo01").html("").hide();
                    _this.page(index + 1, _h);
                
            }).on("swipeDown", function(){
                 $("#mainvideo01").html("").hide();
                if (index != 0) {
                    _this.page(index - 1, _h);
                }
            });
        });
    },
    init: function() {
        var _this = this,
            _len = $(".layout").length,
            _h = $(window).height(),
            _w = $(window).width();

        var ua = _this.UA();
        if(ua.iphone && ua.qqnews_version != "" &&  _this.compareVersions(ua.qqnews_version ,"<","4.4")) {//在IOS的 新闻客户端中执行
            _h = _h - 44;
        }
        $(".picList").height(_h);
        $(".global,.screen,.layout,.inner").width( _w ).height( _h );
       
        $(".backBnt").bind("click",function() {
            $(".layout").hide();
            _this.page(0, _h);
        });
        // 分享
        $(".share_btn").click(function(e) {
            var evn = e || window.event;
            $("#coverShare").show();
            e.stopPropagation();
        });

        $("#coverShare").bind("click touchend", function() {
            $("#coverShare").hide();
        });
        _this.swipe(_h, _len);
    }
}
// pictures show part.
var picshowIdx = {
    old : 0,
    cur : 0,
    zIdx : 10000,
    chgpic : function() {
        var _this = this;
            _this.zIdx --;
        
        $("#picScl li").eq(_this.old).addClass("cur").css({"z-index":_this.zIdx});

        setTimeout(function() {
            $("#picScl li").eq(_this.cur).removeClass("cur");
            _this.cur = (_this.cur + 1) % 5;
        },4000);
        setTimeout(function() {
            _this.old =  (_this.old + 1) % 5;
            _this.chgpic();
        },2000);
    },
    init : function() {
        var _this = this;
        _this.chgpic()
    }
}
// Loading pictures.
var _drawLoadProgress = function(w) {
    var num = Math.floor(w*100) >= 100 ? 100 : Math.floor(w*100);
    $('.loading-progress').animate({width:$('.loading').width()*num/100}, 100, 'linear');
    $(".loading-num span").html(num+"%");
};
var picLoad = {
    pics : [
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_1.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_2.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_3.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_4.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_5.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg1_6.png",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_1.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_2.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_4.png",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg2_5.png",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg3_1.jpg",
        "http://y1.ifengimg.com/5887c5da2472fe29/2015/3/bg3_2.png"
    ],
    _loadImages: function(pics, callback, len) {
        len = len || pics.length;
        if(pics.length) {
            var IMG = new Image(),
                picelem = pics.shift();
                
            if(window._pandaImageLoadArray){
                window._pandaImageLoadArray = window._pandaImageLoadArray
            }else{
                window._pandaImageLoadArray = [];
            }
            window._pandaImageLoadArray.push(picelem);
            IMG.src = picelem;
            // 从数组中取出对象的一刻，就开始变化滚动条
            _drawLoadProgress(window._pandaImageLoadArray.length/(len*len));
            // 缓存处理
            if (IMG.complete) {
                window._pandaImageLoadArray.shift();
                return this._loadImages(pics,callback, len); 
            }else{
                // 加载处理
                IMG.onload = function() {
                    window._pandaImageLoadArray.shift();
                    IMG.onload = null;  // 解决内存泄漏和GIF图多次触发onload的问题
                }
                // 容错处理 todo 应该如何处理呢?
                // 目前是忽略这个错误，不影响正常使用
                IMG.onerror = function(){
                    window._pandaImageLoadArray.shift();
                    IMG.onerror = null;
                }
                return this._loadImages(pics, callback, len);
            }
            return;
        }
        if(callback) this._loadProgress(callback, window._pandaImageLoadArray.length, len);
    },
    _loadProgress: function(callback, begin, all) {
        
        var loadinterval = setInterval(function(){
            if(window._pandaImageLoadArray.length != 0 && window._pandaImageLoadArray.length != begin){
                _drawLoadProgress((begin - window._pandaImageLoadArray.length )/all);
            }else if(window._pandaImageLoadArray.length == 0){
                _drawLoadProgress(1)
                setTimeout(function(){
                    callback.call(window);
                },500);
                clearInterval(loadinterval);
            }
        },300);
    },
    init: function() {
        var _this = this;
        _this._loadImages(this.pics, function() {
            Layout.page(0, $(window).height());
            setTimeout(function(){$(".loadPage").hide()},1500);
            picshowIdx.init();
        });
    }
}
// Video and audio play part.
var isauto = true ; // Switch for audio play.
var myAudio = document.getElementById("audio");
var media = {
    videoPause: function(isauto) {
        isauto =  false;
        $(".songBox .open").hide();
        $(".songBox .close").show();
        myAudio.pause();
    },
    videoPlay: function(isauto) {
        isauto = true;
        $(".songBox .close").hide();
        $(".songBox .open").show();
        myAudio.play();
    },
    init: function() {
        var _this = this,
            _w = $(window).width(),
            _h = $(window).height(),
            scale = 16 / 9;
        $(".songBox .close").hide();
        $(".songBox .open").show();
        $(".songBox .open").bind("click", _this.videoPause);
        $(".songBox .close").bind("click", _this.videoPlay);
        if(myAudio.paused) {
            myAudio.play();
        }
    	var sendMedia = function() {
            var timestring = new Date().getTime();
            var id = "2914702-280-068-1804";
            var uid = document.cookie.substring(document.cookie.indexOf("userid"), document.cookie.indexOf("userid") + 31).split("=")[1];
            var href = location.href;
            var ref = encodeURIComponent(href);
            var lt = encodeURIComponent(href.substring(0, href.lastIndexOf("/special") + 1));

            var urlScript = 'http://stadig.ifeng.com/media.js?id=' + id
                      + '&ref=' + ref 
                      + '&systemInfo=&uid=' + uid + '&provider=&from=HTML5&snapid=wapifeng&cat=&tm='
                      +timestring + '&url=&dur=&se=手凤专题&vid=&ptype=&lt=' + lt;
            var script = document.createElement("script");
            script.src = urlScript;
            script.type = "text/javascript";
            document.getElementsByTagName("head")[0].appendChild(script);  
        }
        $("#video2").bind("click",function() {
            sendMedia();// 发送统计播放探针
            if (isauto) {
                $(".songBox .close").hide();
                $(".songBox .open").show();
                myAudio.pause();
            }
            var html = ' <div class="close" id="close01"><i class="ico"></i></div>' +
                                '<video id="mp4" src="http://ips.ifeng.com/3gs.ifeng.com/userfiles/video02/2015/01/09/2914702-280-068-1804.mp4" autoplay="autoplay" controls="controls" loop="loop" ></video>"';

            $("#mainvideo01").html(html).css({"padding-top": (_h - _w / scale) / 2 + "px"}).show();
            $("#mp4").css({"width": _w,"height": _w / scale});
            $(".songBox").hide();

            var mp4 = document.getElementById("mp4");
            if(mp4.paused) {
                mp4.play();
            } 

            $("#close01").on("click", function() {
                $("#mainvideo01").html("").hide();
                $(".songBox").show();
                if(isauto) {
                    $(".songBox .close").hide();
                    $(".songBox .open").show();
                    myAudio.play();
                }
                
            })
        })
    }
}
//Start...
Layout.init();
picLoad.init();
media.init();
</script>
</body>
</html>